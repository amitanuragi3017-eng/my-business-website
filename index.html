<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #f8fafc;
            color: #334155;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 24px;
            color: #1e293b;
        }
        
        .dashboard-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        
        .card h2 {
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat {
            font-size: 32px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #64748b;
        }
        
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .search-box::placeholder {
            color: #94a3b8;
        }
        
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        
        .filter-section h3 {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-group label {
            font-size: 13px;
            font-weight: 500;
            color: #475569;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: #334155;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .date-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e2e8f0;
        }
        
        .date-input {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 16px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border-color: #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
        }
        
        .btn-warning:hover {
            background: #d97706;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-clear {
            background: #94a3b8;
            color: white;
            border-color: #94a3b8;
        }
        
        .btn-clear:hover {
            background: #64748b;
        }
        
        table {
            width: 100%;
            background: white;
            border-radius: 12px;
            border-collapse: collapse;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-top: 20px;
        }
        
        thead {
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }
        
        th {
            padding: 12px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        
        td {
            padding: 12px;
            font-size: 13px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tbody tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-completed {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-processing {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .month-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        .action-btn {
            background: none;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 11px;
            margin-right: 4px;
            transition: background 0.2s;
        }
        
        .action-btn:hover {
            background: #f1f5f9;
        }
        
        .edit-btn {
            color: #3b82f6;
            border-color: #93c5fd;
        }
        
        .delete-btn {
            color: #ef4444;
            border-color: #fca5a5;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #1e293b;
            font-size: 18px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            font-weight: 500;
            color: #475569;
        }
        
        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 24px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
            z-index: 1001;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
            font-style: italic;
        }
        
        .import-options {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .import-option-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .import-option-btn:hover {
            background: #f1f5f9;
        }
        
        .import-option-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .import-instructions {
            font-size: 12px;
            color: #64748b;
            margin-top: 8px;
            padding: 8px;
            background: #f8fafc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Payment Dashboard</h1>
    
    <!-- Dashboard Stats -->
    <div class="dashboard-section">
        <div class="card">
            <h2>TOTAL PAYMENTS</h2>
            <div class="stat" id="total-payments">10</div>
            <div class="stat-label">Total count of payments</div>
        </div>
        
        <div class="card">
            <h2>PENDING</h2>
            <div class="stat" id="pending-count">3</div>
            <div class="stat-label">Awaiting confirmation</div>
        </div>
        
        <div class="card">
            <h2>RECEIVED</h2>
            <div class="stat" id="received-count">0</div>
            <div class="stat-label">Successfully received</div>
        </div>
        
        <div class="card">
            <h2>TOTAL AMOUNT</h2>
            <div class="stat" id="total-amount">$14,296.25</div>
            <div class="stat-label">Sum of all payments</div>
        </div>
    </div>
    
    <!-- Search -->
    <div class="controls">
        <input type="text" class="search-box" placeholder="Search vendors or networks..." id="search-input" onkeyup="filterPayments()">
        <button class="btn btn-primary" onclick="openAddModal()">+ Add Payment</button>
    </div>
    
    <!-- Advanced Filters -->
    <div class="filter-section">
        <h3>Filter Payments</h3>
        
        <div class="filters-grid">
            <!-- Network Filter -->
            <div class="filter-group">
                <label for="network-filter">Network</label>
                <select class="filter-select" id="network-filter" onchange="filterPayments()">
                    <option value="all">All Networks</option>
                </select>
            </div>
            
            <!-- Status Filter -->
            <div class="filter-group">
                <label for="status-filter">Status</label>
                <select class="filter-select" id="status-filter" onchange="filterPayments()">
                    <option value="all">All Status</option>
                </select>
            </div>
            
            <!-- Vendor Filter -->
            <div class="filter-group">
                <label for="vendor-filter">Vendor</label>
                <select class="filter-select" id="vendor-filter" onchange="filterPayments()">
                    <option value="all">All Vendors</option>
                </select>
            </div>
            
            <!-- Payment Method Filter -->
            <div class="filter-group">
                <label for="method-filter">Payment Method</label>
                <select class="filter-select" id="method-filter" onchange="filterPayments()">
                    <option value="all">All Methods</option>
                </select>
            </div>
            
            <!-- Month Filter -->
            <div class="filter-group">
                <label for="month-filter">Invoice Month</label>
                <select class="filter-select" id="month-filter" onchange="filterPayments()">
                    <option value="all">All Months</option>
                </select>
            </div>
        </div>
        
        <!-- Date Filters -->
        <div class="date-filters">
            <div class="filter-group">
                <label for="invoice-date-from">Invoice Date From</label>
                <input type="date" class="date-input" id="invoice-date-from" onchange="filterPayments()">
            </div>
            
            <div class="filter-group">
                <label for="invoice-date-to">Invoice Date To</label>
                <input type="date" class="date-input" id="invoice-date-to" onchange="filterPayments()">
            </div>
            
            <div class="filter-group">
                <label for="payment-date-from">Payment Date From</label>
                <input type="date" class="date-input" id="payment-date-from" onchange="filterPayments()">
            </div>
            
            <div class="filter-group">
                <label for="payment-date-to">Payment Date To</label>
                <input type="date" class="date-input" id="payment-date-to" onchange="filterPayments()">
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-clear" onclick="clearAllFilters()">
                Clear All Filters
            </button>
            <button class="btn btn-success" onclick="exportToCSV()">
                Export to CSV
            </button>
            <button class="btn btn-warning" onclick="importData()">
                Import Data
            </button>
            <button class="btn btn-danger" onclick="backupData()">
                Backup Data
            </button>
        </div>
    </div>
    
    <!-- Payments Table -->
    <table id="payments-table">
        <thead>
            <tr>
                <th>Network</th>
                <th>Vendor Name</th>
                <th>Month</th>
                <th>Amount</th>
                <th>Invoice Date</th>
                <th>Payment Date</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Payment Method</th>
                <th>Invoice #</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="payments-body">
            <!-- Payments will be loaded here -->
        </tbody>
    </table>
    
    <!-- Add/Edit Modal -->
    <div class="modal" id="payment-modal">
        <div class="modal-content">
            <h3 id="modal-title">Add New Payment</h3>
            <form id="payment-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Network</label>
                        <input type="text" class="form-input" id="network-input" placeholder="e.g., undefined">
                    </div>
                    <div class="form-group">
                        <label>Vendor Name</label>
                        <input type="text" class="form-input" id="vendor-input" placeholder="e.g., Salesforce" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Amount ($)</label>
                        <input type="number" class="form-input" id="amount-input" placeholder="e.g., 4200.00" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Invoice #</label>
                        <input type="text" class="form-input" id="invoice-input" placeholder="e.g., SF-010" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Invoice Date</label>
                        <input type="date" class="form-input" id="invoice-date-input" required>
                    </div>
                    <div class="form-group">
                        <label>Payment Date</label>
                        <input type="date" class="form-input" id="payment-date-input">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" class="form-input" id="due-date-input" required>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select class="form-input" id="status-input" required>
                            <option value="Pending">Pending</option>
                            <option value="Completed">Completed</option>
                            <option value="Processing">Processing</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Payment Method</label>
                        <select class="form-input" id="method-input" required>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="PayPal">PayPal</option>
                            <option value="Cash">Cash</option>
                            <option value="Check">Check</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="modal-submit-btn">Save Payment</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Import Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <h3>Import Data</h3>
            
            <div class="import-options">
                <div class="import-option-btn active" id="import-json-btn" onclick="setImportType('json')">
                    JSON Format
                </div>
                <div class="import-option-btn" id="import-csv-btn" onclick="setImportType('csv')">
                    CSV Format
                </div>
            </div>
            
            <div class="form-group">
                <label id="import-file-label">Select JSON file to import</label>
                <input type="file" class="form-input" id="import-file">
                
                <div class="import-instructions" id="json-instructions">
                    Upload a JSON file previously exported from this dashboard
                </div>
                <div class="import-instructions" id="csv-instructions" style="display: none;">
                    Upload CSV with columns: Network, Vendor, Amount, Invoice Date, Payment Date, Due Date, Status, Method, Invoice #
                    <br>Format dates as YYYY-MM-DD
                </div>
            </div>
            
            <div class="modal-buttons">
                <button type="button" class="btn btn-secondary" onclick="closeImportModal()">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="processImport()">Import Data</button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">Payment saved successfully!</div>
    
    <script>
        // DATA STORAGE - localStorage on your laptop
        const STORAGE_KEY = 'payment_dashboard_data';
        let payments = [];
        let editingId = null;
        let currentImportType = 'json';
        
        // Initialize with sample data if empty
        function initializeData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            
            if (savedData) {
                payments = JSON.parse(savedData);
            } else {
                // Updated sample data with new fields
                payments = [
                    {
                        id: 1,
                        network: "undefined",
                        vendor: "Salesforce",
                        amount: 4200.00,
                        invoiceDate: "2024-01-28",
                        paymentDate: "2024-01-30",
                        dueDate: "2024-02-15",
                        status: "Completed",
                        method: "Credit Card",
                        invoice: "SF-010"
                    },
                    {
                        id: 2,
                        network: "undefined",
                        vendor: "Atlassian",
                        amount: 950.00,
                        invoiceDate: "2024-01-25",
                        paymentDate: null,
                        dueDate: "2024-02-10",
                        status: "Pending",
                        method: "Bank Transfer",
                        invoice: "AT-009"
                    },
                    {
                        id: 3,
                        network: "undefined",
                        vendor: "GitHub Inc",
                        amount: 75.00,
                        invoiceDate: "2024-01-22",
                        paymentDate: "2024-01-25",
                        dueDate: "2024-02-08",
                        status: "Processing",
                        method: "PayPal",
                        invoice: "GH-008"
                    },
                    {
                        id: 4,
                        network: "undefined",
                        vendor: "Dropbox Inc",
                        amount: 155.00,
                        invoiceDate: "2024-01-20",
                        paymentDate: "2024-01-22",
                        dueDate: "2024-02-05",
                        status: "Completed",
                        method: "Credit Card",
                        invoice: "DB-007"
                    },
                    {
                        id: 5,
                        network: "undefined",
                        vendor: "Zoom Video",
                        amount: 290.00,
                        invoiceDate: "2024-01-18",
                        paymentDate: "2024-01-20",
                        dueDate: "2024-02-01",
                        status: "Completed",
                        method: "PayPal",
                        invoice: "ZM-006"
                    }
                ];
                saveToLocalStorage();
            }
            
            populateFilterOptions();
            filterPayments();
            updateStats();
        }
        
        // Get month name from date
        function getMonthFromDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short' });
        }
        
        // Get month-year from date
        function getMonthYearFromDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        }
        
        // Populate filter dropdowns
        function populateFilterOptions() {
            // Get unique values
            const networks = ['undefined', ...new Set(payments.map(p => p.network).filter(n => n && n !== 'undefined'))];
            const statuses = [...new Set(payments.map(p => p.status))];
            const vendors = [...new Set(payments.map(p => p.vendor))];
            const methods = [...new Set(payments.map(p => p.method))];
            const months = [...new Set(payments.map(p => getMonthYearFromDate(p.invoiceDate)))].sort((a, b) => {
                return new Date(b) - new Date(a);
            });
            
            // Network filter
            const networkFilter = document.getElementById('network-filter');
            networkFilter.innerHTML = '<option value="all">All Networks</option>';
            networks.forEach(network => {
                const option = document.createElement('option');
                option.value = network;
                option.textContent = network;
                networkFilter.appendChild(option);
            });
            
            // Status filter
            const statusFilter = document.getElementById('status-filter');
            statusFilter.innerHTML = '<option value="all">All Status</option>';
            statuses.forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                statusFilter.appendChild(option);
            });
            
            // Vendor filter
            const vendorFilter = document.getElementById('vendor-filter');
            vendorFilter.innerHTML = '<option value="all">All Vendors</option>';
            vendors.forEach(vendor => {
                const option = document.createElement('option');
                option.value = vendor;
                option.textContent = vendor;
                vendorFilter.appendChild(option);
            });
            
            // Method filter
            const methodFilter = document.getElementById('method-filter');
            methodFilter.innerHTML = '<option value="all">All Methods</option>';
            methods.forEach(method => {
                const option = document.createElement('option');
                option.value = method;
                option.textContent = method;
                methodFilter.appendChild(option);
            });
            
            // Month filter
            const monthFilter = document.getElementById('month-filter');
            monthFilter.innerHTML = '<option value="all">All Months</option>';
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthFilter.appendChild(option);
            });
        }
        
        // SAVE to localStorage
        function saveToLocalStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(payments));
            console.log('Data saved to localStorage:', payments.length, 'payments');
        }
        
        // FILTER payments based on all criteria
        function filterPayments() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const networkFilter = document.getElementById('network-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const vendorFilter = document.getElementById('vendor-filter').value;
            const methodFilter = document.getElementById('method-filter').value;
            const monthFilter = document.getElementById('month-filter').value;
            const invoiceDateFrom = document.getElementById('invoice-date-from').value;
            const invoiceDateTo = document.getElementById('invoice-date-to').value;
            const paymentDateFrom = document.getElementById('payment-date-from').value;
            const paymentDateTo = document.getElementById('payment-date-to').value;
            
            let filtered = payments;
            
            // Search filter
            if (searchTerm) {
                filtered = filtered.filter(p => 
                    p.vendor.toLowerCase().includes(searchTerm) ||
                    p.invoice.toLowerCase().includes(searchTerm) ||
                    (p.network && p.network.toLowerCase().includes(searchTerm))
                );
            }
            
            // Network filter
            if (networkFilter !== 'all') {
                filtered = filtered.filter(p => p.network === networkFilter);
            }
            
            // Status filter
            if (statusFilter !== 'all') {
                filtered = filtered.filter(p => p.status === statusFilter);
            }
            
            // Vendor filter
            if (vendorFilter !== 'all') {
                filtered = filtered.filter(p => p.vendor === vendorFilter);
            }
            
            // Method filter
            if (methodFilter !== 'all') {
                filtered = filtered.filter(p => p.method === methodFilter);
            }
            
            // Month filter
            if (monthFilter !== 'all') {
                filtered = filtered.filter(p => getMonthYearFromDate(p.invoiceDate) === monthFilter);
            }
            
            // Invoice date range filter
            if (invoiceDateFrom) {
                filtered = filtered.filter(p => p.invoiceDate >= invoiceDateFrom);
            }
            
            if (invoiceDateTo) {
                filtered = filtered.filter(p => p.invoiceDate <= invoiceDateTo);
            }
            
            // Payment date range filter
            if (paymentDateFrom) {
                filtered = filtered.filter(p => p.paymentDate && p.paymentDate >= paymentDateFrom);
            }
            
            if (paymentDateTo) {
                filtered = filtered.filter(p => p.paymentDate && p.paymentDate <= paymentDateTo);
            }
            
            renderPayments(filtered);
            updateStats(filtered);
        }
        
        // CLEAR all filters
        function clearAllFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('network-filter').value = 'all';
            document.getElementById('status-filter').value = 'all';
            document.getElementById('vendor-filter').value = 'all';
            document.getElementById('method-filter').value = 'all';
            document.getElementById('month-filter').value = 'all';
            document.getElementById('invoice-date-from').value = '';
            document.getElementById('invoice-date-to').value = '';
            document.getElementById('payment-date-from').value = '';
            document.getElementById('payment-date-to').value = '';
            
            renderPayments(payments);
            updateStats(payments);
            showNotification('All filters cleared');
        }
        
        // RENDER payments table
        function renderPayments(filteredPayments = null) {
            const data = filteredPayments || payments;
            const tbody = document.getElementById('payments-body');
            
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="no-data">
                            No payments found. Try adjusting your filters or add a new payment.
                        </td>
                    </tr>
                `;
                return;
            }
            
            data.forEach(payment => {
                const formattedInvoiceDate = formatDate(payment.invoiceDate);
                const formattedPaymentDate = payment.paymentDate ? formatDate(payment.paymentDate) : '—';
                const formattedDueDate = formatDate(payment.dueDate);
                const month = getMonthFromDate(payment.invoiceDate);
                const monthYear = getMonthYearFromDate(payment.invoiceDate);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.network || 'undefined'}</td>
                    <td>${payment.vendor}</td>
                    <td>
                        <span class="month-badge" title="${monthYear}">${month}</span>
                    </td>
                    <td>$${payment.amount.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                    <td>${formattedInvoiceDate}</td>
                    <td>${formattedPaymentDate}</td>
                    <td>${formattedDueDate}</td>
                    <td><span class="status-badge status-${payment.status.toLowerCase()}">${payment.status}</span></td>
                    <td>${payment.method}</td>
                    <td>${payment.invoice}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editPayment(${payment.id})">Edit</button>
                        <button class="action-btn delete-btn" onclick="deletePayment(${payment.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // UPDATE dashboard statistics
        function updateStats(filteredPayments = null) {
            const data = filteredPayments || payments;
            const totalPayments = data.length;
            const pendingCount = data.filter(p => p.status === 'Pending').length;
            const receivedCount = data.filter(p => p.status === 'Completed').length;
            const totalAmount = data.reduce((sum, p) => sum + p.amount, 0);
            
            document.getElementById('total-payments').textContent = totalPayments;
            document.getElementById('pending-count').textContent = pendingCount;
            document.getElementById('received-count').textContent = receivedCount;
            document.getElementById('total-amount').textContent = `$${totalAmount.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
        }
        
        // ADD new payment
        function addPayment(paymentData) {
            const newPayment = {
                id: Date.now(),
                ...paymentData
            };
            
            payments.push(newPayment);
            saveToLocalStorage();
            populateFilterOptions();
            filterPayments();
            showNotification('Payment added successfully!');
        }
        
        // EDIT payment
        function editPayment(id) {
            const payment = payments.find(p => p.id === id);
            if (!payment) return;
            
            editingId = id;
            
            document.getElementById('network-input').value = payment.network;
            document.getElementById('vendor-input').value = payment.vendor;
            document.getElementById('amount-input').value = payment.amount;
            document.getElementById('invoice-date-input').value = payment.invoiceDate;
            document.getElementById('payment-date-input').value = payment.paymentDate || '';
            document.getElementById('due-date-input').value = payment.dueDate;
            document.getElementById('status-input').value = payment.status;
            document.getElementById('method-input').value = payment.method;
            document.getElementById('invoice-input').value = payment.invoice;
            
            document.getElementById('modal-title').textContent = 'Edit Payment';
            document.getElementById('modal-submit-btn').textContent = 'Update Payment';
            openModal();
        }
        
        // UPDATE payment
        function updatePayment(id, paymentData) {
            const index = payments.findIndex(p => p.id === id);
            if (index === -1) return;
            
            payments[index] = { id, ...paymentData };
            saveToLocalStorage();
            populateFilterOptions();
            filterPayments();
            showNotification('Payment updated successfully!');
        }
        
        // DELETE payment
        function deletePayment(id) {
            if (confirm('Are you sure you want to delete this payment?')) {
                payments = payments.filter(p => p.id !== id);
                saveToLocalStorage();
                populateFilterOptions();
                filterPayments();
                showNotification('Payment deleted successfully!');
            }
        }
        
        // EXPORT to CSV
        function exportToCSV() {
            const headers = ['Network', 'Vendor', 'Month', 'Amount', 'Invoice Date', 'Payment Date', 'Due Date', 'Status', 'Method', 'Invoice'];
            const rows = payments.map(p => [
                p.network || 'undefined',
                p.vendor,
                getMonthYearFromDate(p.invoiceDate),
                p.amount.toFixed(2),
                p.invoiceDate,
                p.paymentDate || '',
                p.dueDate,
                p.status,
                p.method,
                p.invoice
            ]);
            
            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `payments-export-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showNotification('Data exported to CSV successfully!');
        }
        
        // IMPORT data
        function importData() {
            currentImportType = 'json';
            setImportType('json');
            document.getElementById('import-modal').style.display = 'flex';
        }
        
        function setImportType(type) {
            currentImportType = type;
            
            const jsonBtn = document.getElementById('import-json-btn');
            const csvBtn = document.getElementById('import-csv-btn');
            const jsonInstructions = document.getElementById('json-instructions');
            const csvInstructions = document.getElementById('csv-instructions');
            const fileLabel = document.getElementById('import-file-label');
            
            if (type === 'json') {
                jsonBtn.classList.add('active');
                csvBtn.classList.remove('active');
                jsonInstructions.style.display = 'block';
                csvInstructions.style.display = 'none';
                fileLabel.textContent = 'Select JSON file to import';
                document.getElementById('import-file').accept = '.json';
            } else {
                jsonBtn.classList.remove('active');
                csvBtn.classList.add('active');
                jsonInstructions.style.display = 'none';
                csvInstructions.style.display = 'block';
                fileLabel.textContent = 'Select CSV file to import';
                document.getElementById('import-file').accept = '.csv';
            }
        }
        
        function closeImportModal() {
            document.getElementById('import-modal').style.display = 'none';
            document.getElementById('import-file').value = '';
        }
        
        function processImport() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (currentImportType === 'json') {
                        processJSONImport(e.target.result);
                    } else {
                        processCSVImport(e.target.result);
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        function processJSONImport(content) {
            const importedData = JSON.parse(content);
            
            if (!Array.isArray(importedData)) {
                throw new Error('Invalid JSON format: Expected array');
            }
            
            if (confirm(`This will replace all current data with ${importedData.length} imported payments. Continue?`)) {
                payments = importedData;
                saveToLocalStorage();
                populateFilterOptions();
                filterPayments();
                closeImportModal();
                showNotification(`Successfully imported ${importedData.length} payments`);
            }
        }
        
        function processCSVImport(content) {
            const lines = content.split('\n');
            if (lines.length < 2) {
                throw new Error('CSV file is empty or invalid');
            }
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const importedData = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const payment = {
                    id: Date.now() + i,
                    network: values[0] || 'undefined',
                    vendor: values[1] || '',
                    amount: parseFloat(values[3]) || 0,
                    invoiceDate: values[4] || new Date().toISOString().split('T')[0],
                    paymentDate: values[5] || null,
                    dueDate: values[6] || new Date().toISOString().split('T')[0],
                    status: values[7] || 'Pending',
                    method: values[8] || 'Credit Card',
                    invoice: values[9] || `INV-${Date.now() + i}`
                };
                
                importedData.push(payment);
            }
            
            if (confirm(`Found ${importedData.length} payments in CSV. Import and replace current data?`)) {
                payments = importedData;
                saveToLocalStorage();
                populateFilterOptions();
                filterPayments();
                closeImportModal();
                showNotification(`Successfully imported ${importedData.length} payments from CSV`);
            }
        }
        
        // BACKUP data
        function backupData() {
            const dataStr = JSON.stringify(payments, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `payment-dashboard-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Backup downloaded successfully!');
        }
        
        // MODAL functions
        function openModal() {
            document.getElementById('payment-modal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('payment-modal').style.display = 'none';
            editingId = null;
            document.getElementById('payment-form').reset();
            document.getElementById('modal-title').textContent = 'Add New Payment';
            document.getElementById('modal-submit-btn').textContent = 'Save Payment';
        }
        
        function openAddModal() {
            editingId = null;
            document.getElementById('payment-form').reset();
            
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            document.getElementById('invoice-date-input').value = today;
            document.getElementById('due-date-input').value = nextWeek;
            
            openModal();
        }
        
        // FORM submission
        document.getElementById('payment-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const paymentData = {
                network: document.getElementById('network-input').value || 'undefined',
                vendor: document.getElementById('vendor-input').value,
                amount: parseFloat(document.getElementById('amount-input').value),
                invoiceDate: document.getElementById('invoice-date-input').value,
                paymentDate: document.getElementById('payment-date-input').value || null,
                dueDate: document.getElementById('due-date-input').value,
                status: document.getElementById('status-input').value,
                method: document.getElementById('method-input').value,
                invoice: document.getElementById('invoice-input').value
            };
            
            if (editingId) {
                updatePayment(editingId, paymentData);
            } else {
                addPayment(paymentData);
            }
            
            closeModal();
        });
        
        // UTILITY functions
        function formatDate(dateString) {
            if (!dateString) return '—';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }
        
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            
            // Close modals on outside click
            document.getElementById('payment-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            document.getElementById('import-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeImportModal();
                }
            });
            
            // Set default dates for filters (current month)
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            document.getElementById('invoice-date-from').value = firstDay.toISOString().split('T')[0];
            document.getElementById('invoice-date-to').value = lastDay.toISOString().split('T')[0];
            
            console.log('Payment Dashboard initialized with new columns and CSV import');
        });
    </script>
</body>
</html>
